{{define "title"}}Settings - Portal Ticketing{{end}}
{{define "page_title"}}Pengaturan Akun{{end}}
{{define "page_subtitle"}}Kelola informasi profil dan keamanan akun Anda{{end}}
{{define "extra_css"}}
<link rel="stylesheet" href="/static/settings.css">
{{end}}
{{define "content"}}
<div class="settings-container">
    {{if .success}}
    <div class="alert alert-success">
        <svg class="alert-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <path d="M22 4L12 14.01L9 11.01"/>
        </svg>
        <span>{{.success}}</span>
    </div>
    {{end}}

    {{if .errors}}
    <div class="alert alert-error">
        <svg class="alert-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <path d="M12 8V12"/>
            <path d="M12 16H12.01"/>
        </svg>
        <span>Terjadi kesalahan. Silakan periksa kembali form Anda.</span>
    </div>
    {{end}}

    <!-- Profile Settings -->
    <div class="settings-card">
        <h2>Informasi Profil</h2>
        <form method="post" action="/settings/profile">
            <input type="hidden" name="update_profile" value="1">
            
            <div class="form-group">
                <label for="username" class="form-label">Username</label>
                <input type="text" name="username" id="username" class="form-input" value="{{if .user}}{{.user.Username}}{{end}}" required>
                {{if .errors.username}}
                    <div class="form-error">{{.errors.username}}</div>
                {{end}}
            </div>

            <div class="form-group">
                <label for="email" class="form-label">Email</label>
                <input type="email" name="email" id="email" class="form-input" value="{{if .user}}{{.user.Email}}{{end}}" required>
                {{if .errors.email}}
                    <div class="form-error">{{.errors.email}}</div>
                {{end}}
            </div>

            <div class="form-group">
                <label for="first_name" class="form-label">Nama Depan</label>
                <input type="text" name="first_name" id="first_name" class="form-input" value="{{if .user}}{{.user.FirstName}}{{end}}">
                {{if .errors.first_name}}
                    <div class="form-error">{{.errors.first_name}}</div>
                {{end}}
            </div>

            <div class="form-group">
                <label for="last_name" class="form-label">Nama Belakang</label>
                <input type="text" name="last_name" id="last_name" class="form-input" value="{{if .user}}{{.user.LastName}}{{end}}">
                {{if .errors.last_name}}
                    <div class="form-error">{{.errors.last_name}}</div>
                {{end}}
            </div>

            <button type="submit" class="btn-primary">Simpan Perubahan</button>
        </form>
    </div>

    <!-- Password Change -->
    <div class="settings-card">
        <h2>Ubah Password</h2>
        <form method="post" action="/settings/password">
            <input type="hidden" name="change_password" value="1">
            
            <div class="form-group">
                <label for="old_password" class="form-label">Password Lama</label>
                <input type="password" name="old_password" id="old_password" class="form-input" required>
                {{if .errors.old_password}}
                    <div class="form-error">{{.errors.old_password}}</div>
                {{end}}
            </div>

            <div class="form-group">
                <label for="new_password1" class="form-label">Password Baru</label>
                <input type="password" name="new_password1" id="new_password1" class="form-input" required>
                {{if .errors.new_password1}}
                    <div class="form-error">{{.errors.new_password1}}</div>
                {{end}}
            </div>

            <div class="form-group">
                <label for="new_password2" class="form-label">Konfirmasi Password Baru</label>
                <input type="password" name="new_password2" id="new_password2" class="form-input" required>
                {{if .errors.new_password2}}
                    <div class="form-error">{{.errors.new_password2}}</div>
                {{end}}
            </div>

            <button type="submit" class="btn-primary">Ubah Password</button>
        </form>
    </div>

    <!-- Account Info -->
    <div class="settings-card">
        <h2>Informasi Akun</h2>
        <div class="form-group">
            <label class="form-label">Tanggal Bergabung</label>
            <div class="account-info-item">
                {{if .user}}{{date .user.CreatedAt}}{{end}}
            </div>
        </div>
        <div class="form-group">
            <label class="form-label">Terakhir Login</label>
            <div class="account-info-item">
                {{if .user.LastLogin}}{{date .user.LastLogin}}{{else}}Belum pernah login{{end}}
            </div>
        </div>
    </div>
</div>
{{end}}

{{define "tickets/settings"}}
{{template "base" .}}
{{end}}
